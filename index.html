<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API 호출</title>
</head>

<body>
  <h1>API 호출</h1>
  <input type="file" id="imageInput">
  <button onclick="callAPI()">API 요청</button>

  <div id="result"></div> <!-- 결과를 출력할 요소 -->

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    function callAPI() {
      const button = document.querySelector("button");
      button.disabled = true; // API 요청 중복 실행 방지

      const fileInput = document.getElementById("imageInput");
      const file = fileInput.files[0];

      const reader = new FileReader();
      reader.onload = function (event) {
        const image = event.target.result.split(",")[1];

        axios({
          method: "POST",
          url: "https://detect.roboflow.com/money-counter/1",
          params: {
            api_key: "PfIvNupC996GClMCRkkl",
          },
          data: image,
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
        })
          .then(function (response) {
            const jsonData = response.data;
            const classNames = jsonData.predictions.map((prediction) => prediction.class);

            const resultDiv = document.getElementById("result");
            resultDiv.textContent = classNames.join(", "); // 결과를 출력

            // TODO: 클래스 이름을 원하는 방식으로 처리
          })
          .catch(function (error) {
            console.log(error.message);
          })
          .finally(function () {
            button.disabled = false; // API 요청 후 버튼 활성화
          });
      };

      reader.readAsDataURL(file);
    }
  </script>
</body>

</html>